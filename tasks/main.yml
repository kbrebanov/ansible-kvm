---
# tasks file for kvm

- name: Include distribution specific variables
  include_vars: "{{ ansible_distribution }}.yml"
  tags: kvm

- include: CentOS.yml
  when: ansible_distribution == "CentOS"
  tags:
    - kvm

- include: Ubuntu.yml
  when: ansible_distribution == "Ubuntu"
  tags:
    - kvm

- name: Configure packet forwarding between interfaces
  sysctl: 
    name: "net.ipv4.ip_forward"
    value: 1
    state: present
  tags:
    - kvm
    - configure

- name: Configure libvirtd
  template:
    src: libvirtd.conf.j2
    dest: /etc/libvirt/libvirtd.conf
    mode: 0644
    owner: root
    group: root
  notify:
    - restart libvirtd
  tags:
    - kvm
    - configure

- name: Configure QEMU
  template:
    src: qemu.conf.j2
    dest: /etc/libvirt/qemu.conf
    mode: 0600
    owner: root
    group: root
  notify:
    - restart libvirtd
  tags: 
     - kvm
     - configure

